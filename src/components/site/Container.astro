---
import type { ImageMetadata } from "astro";
import { Image } from "astro:assets";

interface Props {
    class?: string;
    imgUrl?: string | ImageMetadata;
}

// Props destructuring
const { class: className, imgUrl, ...props } = Astro.props as Props;

// Helper: paksa TS tahu tipe src
function resolveImageSrc(img?: string | ImageMetadata): string | ImageMetadata | undefined {
    if (!img) return;

    if (typeof img === "string") return img;              // remote URL
    if (typeof img === "object" && "src" in img) return img;  // local import
}

// Paksa TS yakin src adalah string atau ImageMetadata
const imageSrc = resolveImageSrc(imgUrl) as string | ImageMetadata | undefined;
const hasBgImg = !!imageSrc;
---

<div
    class:list={[
        "container mx-auto",
        hasBgImg && "bg-black relative overflow-hidden isolate group",
        className
    ]}
    {...props}
>
    {hasBgImg && (
        <>
            <Image
                src={imageSrc}
                alt=""
                class="absolute inset-0 w-full h-full object-cover transition-opacity opacity-0 ease-in-out"
                width={1920}
                height={480}
                loading="lazy"
                onload="this.classList.add('opacity-100')"
            />
            <div
                class="absolute inset-0
                       bg-gradient-to-b from-black/70 via-black/50 to-black/70
                       backdrop-blur-xs transition-all ease-out
                       pointer-events-none group-hover:backdrop-blur-[2px]"
            ></div>
        </>
    )}

    <slot/>
</div>
