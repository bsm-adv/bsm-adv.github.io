import{$ as d}from"./dom.BjsoGNXY.js";const o=c=>c.normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^a-zA-Z0-9\s-]/g,"").trim().replace(/\s+/g,"-").replace(/-+/g,"-").toLowerCase();class P{items;filteredItems;filters={jenis:[],ukuran:[],kota:[]};currentPage=1;itemsPerPage=16;gridContainer;paginationContainer;template;statusElement;constructor(t,n,a,i,e=16){this.items=t,this.filteredItems=[...t],this.itemsPerPage=e,this.gridContainer=d(n),this.paginationContainer=d(a),this.template=d(i),this.statusElement=document.querySelector('[data-role="filter-status"]'),this.init()}init(){this.readURLParams(),this.syncUI(),this.applyFilters(),this.bindEvents(),window.addEventListener("popstate",()=>{this.readURLParams(),this.syncUI(),this.applyFilters()})}bindEvents(){document.querySelectorAll("[data-group]").forEach(a=>{a.addEventListener("change",()=>{this.handleFilterChange()})}),this.paginationContainer.addEventListener("click",a=>{const e=a.target.closest("button");if(!e||e.disabled)return;const r=e.dataset.page;r&&this.goToPage(parseInt(r))});const n=document.querySelector('[data-role="reset-filter"]');n&&n.addEventListener("click",()=>{document.querySelectorAll("[data-group]").forEach(i=>{i instanceof HTMLInputElement?i.type==="radio"&&i.value===""&&i.checked===!1&&i.click():i instanceof HTMLSelectElement&&(i.value="",i.dispatchEvent(new Event("change")))})})}readURLParams(){const t=new URLSearchParams(window.location.search);this.filters.jenis=t.getAll("jenis"),this.filters.ukuran=t.getAll("ukuran"),this.filters.kota=t.getAll("kota");const n=t.get("page");this.currentPage=n?parseInt(n):1}updateURL(){const t=new URLSearchParams;this.filters.jenis.forEach(i=>t.append("jenis",i)),this.filters.ukuran.forEach(i=>t.append("ukuran",i)),this.filters.kota.forEach(i=>t.append("kota",i)),this.currentPage>1&&t.set("page",String(this.currentPage));const n=t.toString(),a=n?`${window.location.pathname}?${n}`:window.location.pathname;window.history.replaceState({},"",a)}syncUI(){document.querySelectorAll("input[data-group]").forEach(n=>{n.type==="radio"?n.checked=n.value==="":n.type==="checkbox"&&(n.checked=!1)}),document.querySelectorAll("select[data-group]").forEach(n=>n.value="");const t=(n,a)=>{document.querySelectorAll(`[data-group="${n}"]`).forEach(e=>{if(e instanceof HTMLInputElement){if(e.type==="radio"){const r=e.value?o(e.value):"";(a.length>0&&a.includes(r)||a.length===0&&e.value==="")&&(e.checked=!0)}}else if(e instanceof HTMLSelectElement&&a.length>0){const r=Array.from(e.options).find(s=>o(s.value)===a[0]&&s.value!=="");r&&(e.value=r.value)}})};t("jenis",this.filters.jenis),t("ukuran",this.filters.ukuran),t("kota",this.filters.kota)}handleFilterChange(){const t=n=>{const a=document.querySelectorAll(`[data-group="${n}"]`),i=[];return a.forEach(e=>{e instanceof HTMLInputElement?e.checked&&e.value!==""&&i.push(o(e.value)):e instanceof HTMLSelectElement&&e.value!==""&&i.push(o(e.value))}),i};this.filters.jenis=t("jenis"),this.filters.ukuran=t("ukuran"),this.filters.kota=t("kota"),this.currentPage=1,this.applyFilters(),this.updateURL()}applyFilters(){const t=(n,a)=>n.length===0?!0:n.includes(o(a));this.filteredItems=this.items.filter(n=>{const a=t(this.filters.jenis,n.jenis),i=t(this.filters.ukuran,n.ukuran),e=t(this.filters.kota,n.kota);return a&&i&&e}),this.render()}render(){this.renderGrid(),this.renderPagination(),this.updateStatus()}renderGrid(){if(this.gridContainer.innerHTML="",this.filteredItems.length===0){this.gridContainer.innerHTML=`
        <div class="col-span-full py-12 text-center text-gray-500">
          <p class="text-lg">Tidak ada produk yang sesuai kriteria.</p>
        </div>
      `;return}const t=(this.currentPage-1)*this.itemsPerPage,n=t+this.itemsPerPage,a=this.filteredItems.slice(t,n),i=document.createDocumentFragment();a.forEach(e=>{const r=this.template.content.cloneNode(!0),s=r.querySelector("a");s&&(s.href=e.detailUrl,s.dataset.id=e.id);const h=r.querySelector('[data-bind="jenis"]');h&&(h.textContent=e.jenis);const g=r.querySelector('[data-bind="ukuran"]');g&&(g.textContent=e.ukuran);const l=r.querySelector("img");l&&(l.src=e.imageSrc,l.alt=e.label);const p=r.querySelector('[data-bind="label"]');p&&(p.textContent=e.label);const f=r.querySelector('[data-bind="alamat"]');f&&(f.textContent=e.alamat);const m=r.querySelector('[data-bind="kokab"]');m&&(m.textContent=e.kota);const k=r.querySelector('[data-bind="provinsi"]');k&&(k.textContent=e.provinsi),i.appendChild(r)}),this.gridContainer.appendChild(i)}renderPagination(){const t=Math.ceil(this.filteredItems.length/this.itemsPerPage);if(this.paginationContainer.innerHTML="",t<=1)return;const n=(a,i,e=!1,r=!1)=>{const s=document.createElement("button");return s.className=`
        flex h-10 w-10 items-center justify-center rounded-md border text-sm font-medium transition
        ${e?"border-blue-600 bg-blue-600 text-white":"border-gray-300 bg-white text-gray-700 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed"}
      `,s.textContent=String(a),i>0&&(s.dataset.page=String(i)),r&&(s.disabled=!0),s};this.paginationContainer.appendChild(n("«",this.currentPage-1,!1,this.currentPage===1));for(let a=1;a<=t;a++)this.paginationContainer.appendChild(n(a,a,a===this.currentPage));this.paginationContainer.appendChild(n("»",this.currentPage+1,!1,this.currentPage===t))}updateStatus(){if(this.statusElement){const t=this.filteredItems.length,n=(this.currentPage-1)*this.itemsPerPage+1,a=Math.min(n+this.itemsPerPage-1,t);this.statusElement.textContent=t>0?`Menampilkan ${n}-${a} dari ${t} produk`:""}}goToPage(t){this.currentPage=t,this.render(),this.updateURL()}}const u=document.getElementById("product-data"),y="#product-grid",S="#pagination-container",b="#product-template";if(u){const c=JSON.parse(u.textContent||"[]"),t=Number(u.dataset.itemsPerPage)||16;new P(c,y,S,b,t)}
